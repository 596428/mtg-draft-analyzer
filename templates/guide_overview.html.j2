{% extends "guide_base.html.j2" %}
{% set active_page = "overview" %}
{% set page_title = "Overview" %}

{% block content %}
        <!-- ==========================================
             FORMAT OVERVIEW
             ========================================== -->
        <section id="format-overview">
            <h2>ğŸ“Š Format Overview</h2>

            <!-- Format Speed Analysis Panel (17lands play_draw API) -->
            {% if format_speed and format_speed.average_game_length %}
            <div class="speed-analysis-panel">
                <h3>âš¡ í¬ë§· ì†ë„ ë¶„ì„</h3>

                <!-- 1. ê¸°ì´ˆ ë°ì´í„° (Basic Data) -->
                <div class="speed-data-section">
                    <h4>ğŸ“ˆ ê¸°ì´ˆ ë°ì´í„°</h4>
                    <div class="speed-metrics">
                        <div class="speed-metric">
                            <span class="metric-label">í‰ê·  ê²Œì„ ê¸¸ì´</span>
                            <span class="metric-value">{{ "%.2f" | format(format_speed.average_game_length) }}í„´</span>
                            <span class="metric-range">(ì „ì²´ í¬ë§· ë²”ìœ„: 6.6~9.9í„´)</span>
                        </div>
                        <div class="speed-metric">
                            <span class="metric-label">ì„ ê³µ ìŠ¹ë¥ </span>
                            <span class="metric-value">{{ "%.1f" | format(format_speed.win_rate_on_play * 100) }}%</span>
                            <span class="metric-range">(ì „ì²´ í¬ë§· ë²”ìœ„: 50~54%)</span>
                        </div>
                        {% if format_speed.play_draw_sample_size %}
                        <div class="speed-metric">
                            <span class="metric-label">ë¶„ì„ ê²Œì„ ìˆ˜</span>
                            <span class="metric-value">{{ format_speed.play_draw_sample_size | format_number }}</span>
                            <span class="metric-range">&nbsp;</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- 2. í•´ì„ (Interpretation) -->
                <div class="speed-interpretation-section">
                    <h4>ğŸ” í•´ì„</h4>
                    <p class="interpretation-text">{{ format_speed.speed_interpretation }}</p>
                    <div class="supporting-metrics">
                        ì°¸ê³ : í…œí¬ ë¹„ìœ¨ {{ "%.3f" | format(format_speed.tempo_ratio) }},
                        ì €/ê³ ë§ˆë‚˜ ìŠ¹ë¥ ì°¨ {{ "%+.1f" | format(format_speed.aggro_advantage * 100) }}%p
                    </div>
                </div>

                <!-- 3. ê²°ë¡  (Conclusion) -->
                <div class="speed-conclusion-section">
                    <h4>ğŸ¯ ê²°ë¡ </h4>
                    <span class="speed-badge {{ format_speed.speed_label }}">{{ format_speed.speed_label }}</span>
                    {% if format_speed.recommendation %}
                    <p class="speed-recommendation">{{ format_speed.recommendation }}</p>
                    {% endif %}
                </div>

                {% if format_speed.conflicts %}
                <div class="speed-conflicts">
                    <div class="conflict-title">âš ï¸ ì°¸ê³ : ìƒì¶© ì‹ í˜¸</div>
                    <ul>
                        {% for conflict in format_speed.conflicts %}
                        <li>{{ conflict }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Format Stats Grid -->
            <div class="stat-grid">
                <div class="stat-card">
                    <span class="label">Total Cards</span>
                    <span class="value">{{ total_cards }}</span>
                </div>
                {% if format_speed %}
                <div class="stat-card">
                    <span class="label">
                        Format Speed
                        <span class="info-icon" data-tooltip="í…œí¬ ë¹„ìœ¨ ê¸°ë°˜ í¬ë§· ì†ë„. ë¹ ë¦„: ì–´ê·¸ë¡œ ìœ ë¦¬, ëŠë¦¼: ì»¨íŠ¸ë¡¤ ìœ ë¦¬">â“˜</span>
                    </span>
                    <span class="value {% if 'ë¹ ' in format_speed.speed_label or 'ê³ ì†' in format_speed.speed_label %}fast{% elif 'ëŠ' in format_speed.speed_label %}slow{% endif %}">{{ format_speed.speed_label }}</span>
                </div>
                <div class="stat-card">
                    <span class="label">
                        Tempo Ratio (OH/GD)
                        <span class="info-icon" data-tooltip="ì˜¤í”„ë‹ í•¸ë“œ WR / ë“œë¡œìš° WR. >1.0: ì´ˆë°˜ ìœ ë¦¬, <1.0: í›„ë°˜ ìœ ë¦¬">â“˜</span>
                    </span>
                    <span class="value">{{ "%.3f" | format(format_speed.tempo_ratio) }}</span>
                </div>
                {% endif %}
                {% if splash_indicator %}
                <div class="stat-card">
                    <span class="label">
                        Splash Viability
                        <span class="info-icon" data-tooltip="ë“€ì–¼ëœë“œ ìˆ˜ì™€ í”½ ìˆœìœ„ ê¸°ë°˜. ë†’ìŒ: 3ìƒ‰ ê°€ëŠ¥, ë‚®ìŒ: 2ìƒ‰ ì§‘ì¤‘">â“˜</span>
                    </span>
                    <span class="value {% if 'ë†’' in splash_indicator.splash_label %}high{% elif 'ë‚®' in splash_indicator.splash_label %}low{% endif %}">{{ splash_indicator.splash_label }}</span>
                </div>
                <div class="stat-card">
                    <span class="label">
                        Dual Land ALSA
                        <span class="info-icon" data-tooltip="ë“€ì–¼ëœë“œ í‰ê·  í”½ ìˆœìœ„. ë‚®ì„ìˆ˜ë¡ ìˆ˜ìš” ë†’ìŒ (7.0 ê¸°ì¤€)">â“˜</span>
                    </span>
                    <span class="value">{{ "%.1f" | format(splash_indicator.dual_land_alsa) }}</span>
                </div>
                {% endif %}
            </div>

            {% if llm_format_characteristics or llm_color_strategy or llm_archetype_deep_dive %}
            <div class="format-analysis">
                <h3>ğŸ¤– AI Analysis</h3>
                <div class="analysis-content">
                    {# 1. ğŸ“‹ í¬ë§· íŠ¹ì„± (ë©”íƒ€ìš”ì•½ + ì†ë„ + ìŠ¤í”Œë˜ì‹œ + ì„¸íŠ¸íŠ¹ì§•) #}
                    {% if llm_format_characteristics %}
                    {{ llm_format_characteristics | markdown }}
                    {% endif %}

                    {# 2. ğŸ¨ ìƒ‰ìƒ ì „ëµ (5ìƒ‰ ë¶„ì„ + P1P1 + ìƒìœ„ ì»¤ë¨¼) #}
                    {% if llm_color_strategy %}
                    <hr style="border: none; border-top: 1px solid var(--border-color); margin: 24px 0;">
                    {{ llm_color_strategy | markdown }}
                    {% endif %}

                    {# 3. ğŸ† ìƒìœ„ ì•„í‚¤íƒ€ì… ì‹¬ì¸µ ë¶„ì„ #}
                    {% if llm_archetype_deep_dive %}
                    <hr style="border: none; border-top: 1px solid var(--border-color); margin: 24px 0;">
                    {{ llm_archetype_deep_dive | markdown }}
                    {% endif %}
                </div>
            </div>
            {% elif format_speed and format_speed.recommendation %}
            <div style="margin-top: 20px; padding: 15px; background: var(--bg-card); border-radius: var(--border-radius); border-left: 4px solid var(--accent-blue);">
                <strong>ğŸ’¡ Strategy Tip:</strong> {{ format_speed.recommendation }}
            </div>
            {% endif %}

            {% if llm_strategy %}
            <div class="format-analysis" style="margin-top: 20px;">
                <h3>ğŸ“ Strategy Tips</h3>
                <div class="analysis-content">
                    {{ llm_strategy | markdown }}
                </div>
            </div>
            {% endif %}
        </section>
{% endblock %}
